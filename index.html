<!DOCTYPE html>
<html>
    <head>
        <title>Western Workshop - Using Google Maps API</title>
        <meta name="viewport" content="initial-scale=1.0" />
        <meta charset="utf-8" />
        <style>
        #map {
            height: 100%;
        }
        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        </style>
    </head>
    <body>
        <div id="map"></div>

        <script>
            var map;
            let westernLatLong = { lat: 43.0081693, lng: -81.2766837 };
            let initialZoom = 19.76;

            var getJSON = function(url, callback) {
                console.log("entered getJSON");

                var xhr = new XMLHttpRequest();
                xhr.open('GET', url, true);
                xhr.responseType = 'json';
                xhr.onload = function() {
                    console.log("Did the onload thing...");

                    var status = xhr.status;
                    if (status === 200) {
                        console.log("status was 200");
                        callback(null, xhr.response);
                    } else {
                        console.log("status was NOT 200");
                        callback(status, xhr.response);
                    }
                };
                xhr.send();
            }

            function initMap() {
                map = new google.maps.Map(document.getElementById("map"), {
                    center: westernLatLong,
                    zoom: initialZoom
                });

                var marker = new google.maps.Marker({position: westernLatLong, map: map});

                // Create a <script> tag and set the USGS URL as the source.
                var script = document.createElement('script');

                // This example uses a local copy of the GeoJSON stored at
                // http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/2.5_week.geojsonp
                dataUrl = 'https://data.nasa.gov/resource/gh4g-9sfh.json';
                
                getJSON(dataUrl, function(error, response) {
                    console.log("In the callback....");

                    for (var i = 0; i < response.length; i++) {
                        var coords = response[i].geolocation;
                        if(coords) {
                            var latLng = new google.maps.LatLng(coords.latitude, coords.longitude);
                            var marker = new google.maps.Marker({
                                position: latLng,
                                map: map
                            });
                        }
                    }
                });

            };
        
        </script>
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDva0UUHVFYviFiDtzuIah-tbrCxQcIhYU&callback=initMap" async defer></script>
    </body>
</html>
